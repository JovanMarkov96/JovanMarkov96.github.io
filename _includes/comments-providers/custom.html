<!-- start custom comments snippet -->
<!-- Initial theme detection based on html class -->
<script>
    function injectGiscus() {
        let commentsSection = document.getElementById("comments");
        if (!commentsSection) return;

        // Check if Giscus is already injected to prevent duplicates
        if (commentsSection.querySelector(".giscus")) return;

        // Create the container so it renders inside the main text column
        let giscusContainer = document.createElement("div");
        giscusContainer.className = "giscus";
        commentsSection.appendChild(giscusContainer);

        let giscusTheme = document.documentElement.classList.contains("dark-mode") ? "noborder_dark" : "light";

        // Inject the script dynamically
        let giscusScript = document.createElement("script");
        giscusScript.src = "https://giscus.app/client.js";
        giscusScript.setAttribute("data-repo", "{{ site.comments.giscus.repo }}");
        giscusScript.setAttribute("data-repo-id", "{{ site.comments.giscus.repo_id }}");
        giscusScript.setAttribute("data-category", "{{ site.comments.giscus.category }}");
        giscusScript.setAttribute("data-category-id", "{{ site.comments.giscus.category_id }}");
        giscusScript.setAttribute("data-mapping", "pathname");
        giscusScript.setAttribute("data-strict", "0");
        giscusScript.setAttribute("data-reactions-enabled", "1");
        giscusScript.setAttribute("data-emit-metadata", "0");
        giscusScript.setAttribute("data-input-position", "bottom");
        giscusScript.setAttribute("data-theme", giscusTheme);
        giscusScript.setAttribute("data-lang", "en");
        giscusScript.setAttribute("crossorigin", "anonymous");
        giscusScript.async = true;

        commentsSection.appendChild(giscusScript);
    }

    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", injectGiscus);
    } else {
        injectGiscus();
    }
</script>
<!-- end custom comments snippet -->