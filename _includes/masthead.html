{% include base_path %}

<div class="masthead">
  <div class="masthead__inner-wrap header-row">
    <nav id="site-nav" class="greedy-nav">
      <ul class="visible-links">
        <li class="masthead__menu-item masthead__menu-item--lg"><a href="{{ base_path }}/">{{ site.title }}</a></li>
        {% for link in site.data.navigation.main %}
          {% if link.url contains 'http' %}
            {% assign domain = '' %}
            {% else %}
            {% assign domain = base_path %}
          {% endif %}
          <li class="masthead__menu-item"><a href="{{ domain }}{{ link.url }}">{{ link.title }}</a></li>
        {% endfor %}
      </ul>
    </nav>
    <div class="theme-toggle-container nav-align">
      <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode" aria-pressed="false" aria-describedby="theme-label">
        <span class="highlight-capsule"></span>
        <span class="icon sun" aria-hidden="true">&#x1F31E;</span>
        <span class="icon moon" aria-hidden="true">&#x1F319;</span>
      </button>
      <div class="theme-label" id="theme-label">Light mode active</div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const btn = document.getElementById('theme-toggle');
        const capsule = btn.querySelector('.highlight-capsule');
        const label = document.getElementById('theme-label');
        function setMode(dark) {
          document.documentElement.classList.toggle('dark-mode', dark);
          btn.setAttribute('aria-pressed', dark ? 'true' : 'false');
          label.textContent = dark ? 'Dark mode active' : 'Light mode active';
          capsule.style.transform = dark ? 'translateX(2.5rem)' : 'translateX(0)';
        }
        // Initial state
        let darkMode = localStorage.getItem('darkMode');
        if (darkMode === null) {
          darkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'true' : 'false';
        }
        setMode(darkMode === 'true');
        // Toggle handler
        btn.addEventListener('click', function() {
          const isDark = !document.documentElement.classList.contains('dark-mode');
          setMode(isDark);
          localStorage.setItem('darkMode', isDark);
        });
        // Keyboard accessibility (Enter/Space)
        btn.addEventListener('keydown', function(e) {
          if (e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            btn.click();
          }
        });
      });
    </script>
  </div>
</div>